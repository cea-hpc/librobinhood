{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "5304af2b_2f100dee",
        "filename": "src/backends/mongo/bson.c",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-29T21:57:49Z",
      "side": 1,
      "message": "Does it make sense to only have NSECS? Do we want to gate this with STATX_BTIME | RBH_STATX_BTIME_NSEC both being set?\n(can probably trust the user on that, just asking)",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "432825b8_9f9520a5",
        "filename": "src/backends/mongo/bson.c",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-08-29T22:41:23Z",
      "side": 1,
      "message": "I wondered about it as well... Same way, is there ever going to be a case in which RBH_STATX_XTIME is available but not RBH_STATX_XTIME_NSEC? Would it make sense to return both even if only the main one is requested?\n\nI have no idea, and I think it\u0027s less confusing to have everything be explicit. Makes the API more consistent.",
      "parentUuid": "5304af2b_2f100dee",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2adad212_204971ba",
        "filename": "src/backends/mongo/bson.c",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-30T23:29:56Z",
      "side": 1,
      "message": "Yes I was going to reply that to the other comment (where I mentioned  an extra macro requesting both. That was a bad idea)\n\nSTATX_xTIME should definitely mean both as that is what the original statx flag means, then we need extra flags that specifies only sec or nsec?\n\nTo be honest this is like dev/rdev, I do not see the need to split it.\nFrom a stat/statx point of view either the filesystem supports nsec or not, but the stat call will not know that.\nFrom a query point of view we can make queries slightly faster if we know we only care about either one, but frankly that doesn\u0027t strike me as overly useful... Some backend could store the time as a single u64 with just nsec for example; that\u0027s big enough to cover for the forseeable future (63 bits covers ~292 years, I\u0027m not optimistic enough to think rbh v4 will still be around then :-D)\n\nI don\u0027t have strong feelings about splitting or not, but the statx flag should definitely mean both are set, so if you want to keep it split checks can look like `stx_mask \u0026 (STATX_xTIME | RBH_STATX_xTIME_N?SEC)` meaning it works if either are set.",
      "parentUuid": "432825b8_9f9520a5",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9091066e_44232a24",
        "filename": "src/backends/mongo/bson.c",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-09-01T18:15:19Z",
      "side": 1,
      "message": "\u003e STATX_xTIME should definitely mean both as that is what the original statx flag means, then we need extra flags that specifies only sec or nsec?\n\nI don\u0027t like that:\n     STATX_xTIME !\u003d (RBH_STATX_xTIME_SEC | RBH_STATX_xTIME_NSEC)\n\nWe are already breaking compatibility with the regular `struct statx` anyway, do we get something by maintaining compatibility on that point?\n\n\u003e From a query point of view we can make queries slightly faster\n\nIf it was only about speed, I\u0027d be all for it, but it\u0027s mostly about having the ability to query timestamps at a sub-second resolution.\n\nRight now, querying:\n\n    struct rbh_filter_field atime \u003d {\n        .fsentry \u003d RBH_FP_STATX,\n        .statx \u003d STATX_ATIME,\n    };\n\ntargets `stx_atime.tv_sec`. There is no way to have a better precision than that. [*]\n\nThis is also part of the reason why I\u0027d like to have STATX_ATIME mean only the \"seconds\" field, because then it would mean the same thing in a struct rbh_filter_field and in a struct rbh_fsentry.\n\nNote that we _could_ define the extra flag and just disallow queries on STATX_ATIME: my argument is definitely subjective.",
      "parentUuid": "2adad212_204971ba",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9edc9d3c_61ee84a4",
        "filename": "src/backends/mongo/bson.c",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-09-01T20:52:05Z",
      "side": 1,
      "message": "\u003e I don\u0027t like that STATX_xTIME !\u003d (RBH_STATX_xTIME_SEC | RBH_STATX_xTIME_NSEC)\n\nYes, my suggestion would mean three different flags (or keeping a single one if we don\u0027t split fields -- I finally understood what you meant by \"need separate flags for queries\" for rdev/dev, it\u0027s about the comparison ops? isn\u0027t that going to be a lot of fun to make a comparison that includes nsecs... (sec \u003c x || sec \u003d\u003d x \u0026\u0026 nsec \u003c x)... well ok I guess that\u0027s going to be the same no matter how we dice this unless the db format undertsands what timestamps are...)\n\n\u003e We are already breaking compatibility with the regular `struct statx` anyway, do we get something by maintaining compatibility on that point?\n\nhm, fair point, but I feel less strongly for mandatory fields -- it\u0027s simpler to say \"this comes from statx, so always set these fields\" vs. \"ok is STATX_xTIME set? then set RBH_STATX_xTIME_NSEC too\" for all xTIMEs from a complexity point of view.\n(ultimately, checking two bits everytime vs. checking once when we set it both bring complexity, which is why I prefer not splitting in the first place... ok fair -- but src/backends/posix/posix.c has been patched to set RBH_STATX_ALL \u0026 ~RBH_STATX_ATTRIBUTES inconditionally and I didn\u0027t realize at the time but now we\u0027re having this discussion that doesn\u0027t look correct wrt current xTIME_NSEC fields always being set... If that is fixed I can reluctantly accept that patch as it is, but I\u0027d feel happier with 3/1 flags than this current middle-ground)\n\n\u003e Right now, querying: [STATX_ATIME] targets `stx_atime.tv_sec`. There is no way to have a better precision than that. [*]\n\nErr, which right now? current main branch (pre-patch) targets both, doesn\u0027t it? ah, it is just simplified to seconds for comparison, and it only targets both for storage/lookup?\nI guess in practice that\u0027s good enough and we can keep that behaviour with either my suggestions (3flags: STATX_ATIME would act like both other flags set for storage/lookup and sec for comparison; 1flag: keep same behaviour as we have) -- it\u0027s not perfect but sub-second queries look only like troubles to me unless we can use a single subsecond field (cram it all in a u64/u128)",
      "parentUuid": "9091066e_44232a24",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "55b52654_ffa62df7",
        "filename": "src/backends/mongo/bson.c",
        "patchSetId": 2
      },
      "lineNbr": 101,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-09-01T22:07:00Z",
      "side": 1,
      "message": "\u003e I finally understood what you meant by \"need separate flags for queries\" for rdev/dev, it\u0027s about the comparison ops?\n\nYes, without the flags, we can only filter on STATX_* fields, which is not everything (and of course, there is the issue of sub-structures like with timestamps).\n\n\u003e src/backends/posix/posix.c has been patched to set RBH_STATX_ALL \u0026 ~RBH_STATX_ATTRIBUTES inconditionally and (...) that doesn\u0027t look correct\n\nTrue, needs fixing.\n\n\u003e I\u0027d feel happier with 3/1 flags than this current middle-ground\n\nI was about to suggest adding an RBH_STATX_xTIME_ALL flag that includes both, but how about we throw hardcore-portability out the window altogether and redefine _every_ statx flag with an \"RBH_\" prefix? That way, we can have:\n- RBH_STATX_xTIME_SEC (\u003d\u003d STATX_xTIME)\n- RBH_STATX_xTIME_NSEC (\u003d\u003d what it is right now)\n- RBH_STATX_xTIME \u003d\u003d RBH_STATX_xTIME_SEC | RBH_STATX_xTIME_NSEC.\n\nAnd we can provide a utility function to convert a \"regular\" statx structure into a rbh-compatible one so people don\u0027t have to scratch their head too much.\n\n\u003e \u003e Right now, querying: [STATX_ATIME] targets `stx_atime.tv_sec`. There is no way to have a better precision than that.\n\n\u003e Err, which right now? current main branch (pre-patch) targets both, doesn\u0027t it? ah, it is just simplified to seconds for comparison, and it only targets both for storage/lookup?\n\nYep, you got it: right now \u003d\u003d current main branch (pre-patch).\n\n\u003e it\u0027s not perfect but sub-second queries look only like troubles to me unless we can use a single subsecond field\n\nUtility functions can help with that, someone just needs to get that stuff right once.",
      "parentUuid": "9edc9d3c_61ee84a4",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fe553a22_5d128a3f",
        "filename": "src/backends/mongo/fields.c",
        "patchSetId": 2
      },
      "lineNbr": 14,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-29T21:57:49Z",
      "side": 1,
      "message": "(nitpick) leading space",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4e798845_c58072f0",
        "filename": "src/backends/mongo/fields.c",
        "patchSetId": 2
      },
      "lineNbr": 14,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-08-29T22:41:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fe553a22_5d128a3f",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ccba31b_c1d5a316",
        "filename": "src/backends/mongo/fsentry.c",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-29T21:57:49Z",
      "side": 1,
      "message": "(nitpick) leading space",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f86dde32_71efa7d8",
        "filename": "src/backends/mongo/fsentry.c",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-08-29T22:41:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2ccba31b_c1d5a316",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5609e93_797c43bb",
        "filename": "src/backends/mongo/fsentry.c",
        "patchSetId": 2
      },
      "lineNbr": 366,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-29T21:57:49Z",
      "side": 1,
      "message": "likewise, do we want to error if only tv_nsec is set?",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b53361ea_781f1800",
        "filename": "src/backends/mongo/fsentry.c",
        "patchSetId": 2
      },
      "lineNbr": 366,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-08-29T22:41:23Z",
      "side": 1,
      "message": "I want to say no. Considering we have those new flags that explicitly tell the user \"this is set\"/\"this is not\", I think it\u0027s OK to return only the nanoseconds.\n\nWho knows, maybe someone will find a use for that.",
      "parentUuid": "b5609e93_797c43bb",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce07f6d1_bd397043",
        "filename": "src/backends/mongo/fsentry.c",
        "patchSetId": 2
      },
      "lineNbr": 366,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-29T23:19:13Z",
      "side": 1,
      "message": "Good luck to them finding a use for that, but I\u0027m more worried users could easily only request nsecs when they meant to request sec+nsecs.\nAt the very least this deserves a convenience flag with both like you suggested for rdev to make it easy to use.",
      "parentUuid": "b53361ea_781f1800",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a453babe_d3ac3727",
        "filename": "src/backends/mongo/fsentry.c",
        "patchSetId": 2
      },
      "lineNbr": 366,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-08-30T20:29:24Z",
      "side": 1,
      "message": "Bah, it can wait for a later release. Right now, I\u0027m aiming to get something correct and usable. We can deal with ergonomics later.",
      "parentUuid": "ce07f6d1_bd397043",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae23acf3_1b299068",
        "filename": "src/backends/mongo/options.c",
        "patchSetId": 2
      },
      "lineNbr": 14,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-29T21:57:49Z",
      "side": 1,
      "message": "(nitpick) leading space",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3565a4f5_bfa36e9a",
        "filename": "src/backends/mongo/options.c",
        "patchSetId": 2
      },
      "lineNbr": 14,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-08-29T22:41:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae23acf3_1b299068",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6253b217_431b3c3b",
        "filename": "src/backends/mongo/options.c",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-29T21:57:49Z",
      "side": 1,
      "message": "(likewise a bit late, but..) does it make sense to split major/minor? I can\u0027t think of a scenario where we\u0027d only have either.",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4734443_b55e83bb",
        "filename": "src/backends/mongo/options.c",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-08-29T22:41:23Z",
      "side": 1,
      "message": "I don\u0027t know, but I need the fields to query each separately (or just query them at all), and I think using the flags only for queries would be confusing.\n\nWe (or users) can always define an `RBH_STATX_RDEV` flag that is `RBH_STATX_RDEV_MAJOR | RBH_STATX_RDEV_MINOR`.",
      "parentUuid": "6253b217_431b3c3b",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc17230b_a93b053e",
        "filename": "src/backends/mongo/options.c",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-08-29T23:19:13Z",
      "side": 1,
      "message": "hm, I was thinking of the old stat struct where both are stored in the same long int in memory, but for statx it is split in two u32... So I guess it makes sense to keep these separate in db as well, I\u0027m not sure how big the overhead is tbh, it\u0027s more of an \"it was stored as a single field before, why two now?\" kind of remark.\n\nNo strong feeling either way.",
      "parentUuid": "e4734443_b55e83bb",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9953edb9_d3bd0e7c",
        "filename": "src/backends/mongo/options.c",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-08-30T20:29:24Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "cc17230b_a93b053e",
      "revId": "c88c4b4d721270dedd2d7fecb3d0a5b3802d802d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}