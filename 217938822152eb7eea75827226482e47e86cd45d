{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "af7b1f60_1c39cefd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2022-05-10T09:39:03Z",
      "side": 1,
      "message": "I now know that the component index is not sequential. You can delete components from a composite layout and add some later. For exemple, the following actions will lead to a non sequencial ost index list:\n\nlfs setstripe -E 4M -c 1 -E 64M -c 4 -E -1 -c -1 /mnt/lustre/file1\nlfs setstripe --comp-del -I3 file1\nlfs setstripe --comp-add -E -1 -c -1 file1\n\nThis means that the function which reads the number of components by reading the index of the last component can return a number greater than the actual number of components. I think we should include a test with such a layout so that we make sure the code can handle it correctly (which it may already do).\n\nAlso, for the sake of completeness, since the mapping between component ids dans the position in the list of fields in the database is not so clear, we should probably include de component index as well.",
      "revId": "217938822152eb7eea75827226482e47e86cd45d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e041f602_ff4f3254",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1019048
      },
      "writtenOn": "2022-05-12T09:38:58Z",
      "side": 1,
      "message": "If a component is deleted, Lustre correctly updates the components objects of each file, and since we go through each component with the Lustre iterator, it is correctly managed.\n\nSince the component id can be larger than its index, yes we can \"over-allocate\", but its just that.\n\nHowever, this highlighted an issue with my code, because I was assuming the actual length of each array was the same as the id of the last component, which is wrong. I just modified it to use the comp_index in iterator_data instead.\n\nAnd for keeping the component index, yes why not, we\u0027ll have to talk about it.",
      "parentUuid": "af7b1f60_1c39cefd",
      "revId": "217938822152eb7eea75827226482e47e86cd45d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4668a9fc_a7f6a50f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1019048
      },
      "writtenOn": "2022-05-12T09:40:05Z",
      "side": 1,
      "message": "Keeping the component id*",
      "parentUuid": "e041f602_ff4f3254",
      "revId": "217938822152eb7eea75827226482e47e86cd45d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "185c3e05_710fd16c",
        "filename": "src/backends/lustre/lustre.c",
        "patchSetId": 4
      },
      "lineNbr": 286,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2022-05-10T09:39:03Z",
      "side": 1,
      "message": "question: why do you check EINVAL?",
      "range": {
        "startLine": 286,
        "startChar": 24,
        "endLine": 286,
        "endChar": 43
      },
      "revId": "217938822152eb7eea75827226482e47e86cd45d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b6ccde1f_df9ff22f",
        "filename": "src/backends/lustre/lustre.c",
        "patchSetId": 4
      },
      "lineNbr": 286,
      "author": {
        "id": 1019048
      },
      "writtenOn": "2022-05-12T09:38:58Z",
      "side": 1,
      "message": "Because a component can have a valid stripe count, but no OST used. So this will be returned as an error, but isn\u0027t one, and we have to ignore it.\n\nHowever, this was missing the management of actual errors.",
      "parentUuid": "185c3e05_710fd16c",
      "range": {
        "startLine": 286,
        "startChar": 24,
        "endLine": 286,
        "endChar": 43
      },
      "revId": "217938822152eb7eea75827226482e47e86cd45d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}