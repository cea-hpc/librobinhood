{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "6f8962b9_edbacd25",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T08:33:41Z",
      "side": 1,
      "message": "So, sorry for this second round. This patch was not modified since the last review.",
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "41f9b66b_a85298f0",
        "filename": "include/ring.h",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "suggest: this header defines the rbh_ring structure, I think that\u0027s its main purpose. It doesn\u0027t just make this struture\u0027s internals visible outside of ring.c.\n\nI would write: Internal header which defines the rbh_ring structure and makes it available to related structures.",
      "range": {
        "startLine": 14,
        "startChar": 3,
        "endLine": 14,
        "endChar": 58
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "738b121c_06b2b7e3",
        "filename": "include/ring.h",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "41f9b66b_a85298f0",
      "range": {
        "startLine": 14,
        "startChar": 3,
        "endLine": 14,
        "endChar": 58
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6dbf309b_aa6a97ec",
        "filename": "include/robinhood/ringr.h",
        "patchSetId": 1
      },
      "lineNbr": 96,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "typo: at",
      "range": {
        "startLine": 96,
        "startChar": 43,
        "endLine": 96,
        "endChar": 45
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "418603fe_144ab17b",
        "filename": "include/robinhood/ringr.h",
        "patchSetId": 1
      },
      "lineNbr": 96,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6dbf309b_aa6a97ec",
      "range": {
        "startLine": 96,
        "startChar": 43,
        "endLine": 96,
        "endChar": 45
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4cbb945a_2e83ec0c",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 23,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "comment: I think starved is not very explicit. I\u0027m not sure I fully understand it\u0027s purpose.",
      "range": {
        "startLine": 23,
        "startChar": 9,
        "endLine": 23,
        "endChar": 16
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f0894a7_b4abb1ae",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 23,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "Starved means here the there is no more data to read. It is easy to see the reader is not starved when its head is different than the ring one, but when both heads are identical, it means either all was read or none is left to read. This boolean is set to true when the heads are the same during the \u0027ack\u0027 process.\n\nThis boolean is then used to compute the number of readable bytes.",
      "parentUuid": "4cbb945a_2e83ec0c",
      "range": {
        "startLine": 23,
        "startChar": 9,
        "endLine": 23,
        "endChar": 16
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "48faf354_059e8044",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 23,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-06-14T18:49:58Z",
      "side": 1,
      "message": "\"starve\"/\"starvation\" is a pretty common word to encounter in CS when dealing with readers and writers.\n\nIt appears 8 times in https://en.wikipedia.org/wiki/Readers%E2%80%93writers_problem  for example.",
      "parentUuid": "9f0894a7_b4abb1ae",
      "range": {
        "startLine": 23,
        "startChar": 9,
        "endLine": 23,
        "endChar": 16
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6218bc7e_7ce467c7",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "comment: I find the name of this structure confusing. To me it suggests that this is a ring with multiple readers. Then I would expect to have a list of readers, not a list of ringr.\n\nI would prefer something like rbh_reader which, I think, better encapsulate the idea behind this new structure. I think I remember from a past conversation that this name is not available. Is this right?",
      "range": {
        "startLine": 24,
        "startChar": 11,
        "endLine": 24,
        "endChar": 20
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0059a5e2_b950cc58",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "\u0027ringr\u0027 is indeed named after \u0027ring_reader\u0027. So they contain a list of readers.\n\nThe issue is not that rbh_reader is not available (because it is), but this is a specific reader for rings only. So we needed a name that contain this information. It was first \u0027ring_reader\u0027, later shorten to \u0027ringr\u0027.",
      "parentUuid": "6218bc7e_7ce467c7",
      "range": {
        "startLine": 24,
        "startChar": 11,
        "endLine": 24,
        "endChar": 20
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19e85306_9f889958",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-06-14T18:49:58Z",
      "side": 1,
      "message": "I agree with Sebastien.",
      "parentUuid": "0059a5e2_b950cc58",
      "range": {
        "startLine": 24,
        "startChar": 11,
        "endLine": 24,
        "endChar": 20
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "28f5f262_2fe15fc9",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-15T09:51:43Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "19e85306_9f889958",
      "range": {
        "startLine": 24,
        "startChar": 11,
        "endLine": 24,
        "endChar": 20
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "628f2fe7_13f83401",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "comment: I find the name of this function misleading. To me, it suggests that the returned rbh_ringr *duplicate is a copy of the state of the argument while in fact it returns a new ringr with the same ring, a new reader and the previous reader. I would think that duplicating a ringr would duplicate the ring and the readers but not adding a new reader.\n\nMaybe something like rbh_ringr_new_reader would be more explicit? Or add_reader?",
      "range": {
        "startLine": 55,
        "startChar": 0,
        "endLine": 55,
        "endChar": 13
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0a0172c_069a592d",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "I see your point.\n\nFirst, rbh_ringr_dup duplicates a reader, and its state, and not a ring. So here we create a new reader of the same ring, pointing to the same place in ring data.\n\nrbh_ringr_new_reader or add_reader could have been correct if we had access to the ring structure. But this is not the case in this implementation. We can have an rbh_ring, without readers using push() \u0026 pop() mechanisms, or we can have multiple readers of the same ring, without directly managing the ring.",
      "parentUuid": "628f2fe7_13f83401",
      "range": {
        "startLine": 55,
        "startChar": 0,
        "endLine": 55,
        "endChar": 13
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8da16d2e_38cb6486",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-06-14T18:49:58Z",
      "side": 1,
      "message": "A ring reader is somewhat equivalent to a file descriptor, in which case rbh_ring_dup() would be the equivalent of the dup() syscall.\n\nI find this makes it a good name. ðŸ˜Š",
      "parentUuid": "f0a0172c_069a592d",
      "range": {
        "startLine": 55,
        "startChar": 0,
        "endLine": 55,
        "endChar": 13
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "66b74dae_66389f08",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-15T09:51:43Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "8da16d2e_38cb6486",
      "range": {
        "startLine": 55,
        "startChar": 0,
        "endLine": 55,
        "endChar": 13
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54442940_0915937e",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 102,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "question: I don\u0027t know the code well enough. Does the head member in rbh_ring correspond to the position of the last byte written on the ring\u0027s buffer? Which would then make this comparison licit.",
      "range": {
        "startLine": 102,
        "startChar": 20,
        "endLine": 102,
        "endChar": 22
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e399103_accdedd4",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 102,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "Yes, that\u0027s right.",
      "parentUuid": "54442940_0915937e",
      "range": {
        "startLine": 102,
        "startChar": 20,
        "endLine": 102,
        "endChar": 22
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "891c9dac_43690385",
        "filename": "src/ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 102,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-15T09:51:43Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "7e399103_accdedd4",
      "range": {
        "startLine": 102,
        "startChar": 20,
        "endLine": 102,
        "endChar": 22
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74a95368_e6d5d4e3",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 81,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "question: aren\u0027t these the same test?",
      "range": {
        "startLine": 67,
        "startChar": 1,
        "endLine": 81,
        "endChar": 8
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "89db509b_70a6269a",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 81,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "Done\n\nYou are right, the second test must check a size equals to 1 instead of 0.",
      "parentUuid": "74a95368_e6d5d4e3",
      "range": {
        "startLine": 67,
        "startChar": 1,
        "endLine": 81,
        "endChar": 8
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ddafaad5_badd6051",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 178,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "question: since we have a function which reads randoms data, why not using it here?",
      "range": {
        "startLine": 178,
        "startChar": 8,
        "endLine": 178,
        "endChar": 22
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "186ada0e_e4bf1de4",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 178,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "The random_read function makes system calls which are slower than just setting buffer with arbitrary values.",
      "parentUuid": "ddafaad5_badd6051",
      "range": {
        "startLine": 178,
        "startChar": 8,
        "endLine": 178,
        "endChar": 22
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3ed35482_0a91e830",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 178,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-15T09:51:43Z",
      "side": 1,
      "message": "I meant that having random data in the buffer would make the test more robust. And since we have a function that does that it would be easy to do. But I\u0027m fine with this approach.",
      "parentUuid": "186ada0e_e4bf1de4",
      "range": {
        "startLine": 178,
        "startChar": 8,
        "endLine": 178,
        "endChar": 22
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "688f486d_857b3b76",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 246,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "question: is the idea of this test to push page_size-15 bytes in a buffer of size page_size already containing 16 bytes (so the push is 1 byte too big)? And then see the push fail because of the size?\n\nWhy not having a rbh_ringr_empty() to test whether a buffer is empty or not? It may be a useful tool in practice and more explicit here.",
      "range": {
        "startLine": 246,
        "startChar": 4,
        "endLine": 246,
        "endChar": 73
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a0599b3_30541b86",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 246,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "Correct for the test goal.\n\nAn rbh_ringr_empty() function will not check if a buffer is empty, but if the reader still has bytes to read instead.",
      "parentUuid": "688f486d_857b3b76",
      "range": {
        "startLine": 246,
        "startChar": 4,
        "endLine": 246,
        "endChar": 73
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c58d410e_e16aeb9c",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 246,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-15T09:51:43Z",
      "side": 1,
      "message": "Then if I understand the implementation correctly, rbh_ringr_starved() ?\nIt\u0027s just a suggestion, it may be a handy utility function.",
      "parentUuid": "0a0599b3_30541b86",
      "range": {
        "startLine": 246,
        "startChar": 4,
        "endLine": 246,
        "endChar": 73
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10f2caf2_bc5bcd2d",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 246,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-15T13:42:35Z",
      "side": 1,
      "message": "Yes, but you already have this behavior using `rbh_ringr_peek()`. If the size argument is zero, it means your reader is starving.",
      "parentUuid": "c58d410e_e16aeb9c",
      "range": {
        "startLine": 246,
        "startChar": 4,
        "endLine": 246,
        "endChar": 73
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5205afc9_eb4da3bb",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 289,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2021-06-14T12:39:02Z",
      "side": 1,
      "message": "question: why is there no assertions here?",
      "range": {
        "startLine": 279,
        "startChar": 2,
        "endLine": 289,
        "endChar": 44
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b1a20ff1_accf7405",
        "filename": "tests/unit/check_ringr.c",
        "patchSetId": 1
      },
      "lineNbr": 289,
      "author": {
        "id": 1017196
      },
      "writtenOn": "2021-06-14T15:31:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5205afc9_eb4da3bb",
      "range": {
        "startLine": 279,
        "startChar": 2,
        "endLine": 289,
        "endChar": 44
      },
      "revId": "c40a4e01bcdeb3df6a0280b6821dda71eb3c92d3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}