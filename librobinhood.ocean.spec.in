Name:    librobinhood
Version: @version@
Release: 1%{?dist}
Summary: Main library for RobinHood V4

Group:   Applications/System
License: LGPLv3
URL:     https://github.com/cea-hpc/librobinhood.git
Source0: %{name}-%{version}.tar.xz

Requires: mongo-c-driver-libs
Requires: mongodb
Requires: pkgconf-pkg-config
Requires: lustre-client

BuildRequires: meson
BuildRequires: gcc
BuildRequires: gcc-c++
BuildRequires: mongo-c-driver-devel
BuildRequires: jansson-devel
BuildRequires: check-devel
BuildRequires: lustre-client

%description
The main library for the RobinHood project. It runs on machines that runs
a Mongo database.

%package devel
Summary: C API for RobinHood V4.

Requires: librobinhood

%description devel
This package contains header files and libraries to use the librobinhood from a
C program.

%prep
%autosetup

%build
%meson
%meson_build

%install
%meson_install

rm -f $RPM_BUILD_ROOT/%{_libdir}/librbh-hestia.so*
rm -f $RPM_BUILD_ROOT/%{_includedir}/robinhood/backends/hestia.h

%files

%{_libdir}/librobinhood.so.*
%{_libdir}/librbh-lustre.so*
%{_libdir}/librbh-mongo.so*
%{_libdir}/librbh-posix.so*
%{_libdir}/pkgconfig/robinhood.pc

%files devel

%{_libdir}/librobinhood.so
%{_includedir}/robinhood.h
%{_includedir}/robinhood/backend.h
%{_includedir}/robinhood/backends/lustre.h
%{_includedir}/robinhood/backends/mongo.h
%{_includedir}/robinhood/backends/posix.h
%{_includedir}/robinhood/filter.h
%{_includedir}/robinhood/fsentry.h
%{_includedir}/robinhood/fsevent.h
%{_includedir}/robinhood/id.h
%{_includedir}/robinhood/iterator.h
%{_includedir}/robinhood/itertools.h
%{_includedir}/robinhood/plugin.h
%{_includedir}/robinhood/plugins/backend.h
%{_includedir}/robinhood/queue.h
%{_includedir}/robinhood/ring.h
%{_includedir}/robinhood/ringr.h
%{_includedir}/robinhood/sstack.h
%{_includedir}/robinhood/stack.h
%{_includedir}/robinhood/statx.h
%{_includedir}/robinhood/uri.h
%{_includedir}/robinhood/utils.h
%{_includedir}/robinhood/value.h

%changelog

* Fri Apr 7 2023 - Yoann Valeri <yoann.valeri@cea.fr> - 0.1-1
- First version
- Support the POSIX, Mongo and Lustre backends
