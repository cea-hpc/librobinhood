{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "86e6491d_b46a9f9c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-09-04T13:20:26Z",
      "side": 1,
      "message": "hmm if mnt id is the same mnt id that\u0027s used for handle ops (open_by_handle_at/name_to_handle_at) then I\u0027m pretty sure it\u0027s not constant across mounts (so different clients will have different values, this is obvious when mounting the same lustre fs twice for example)\n\nin that case I don\u0027t think it makes sense for robinhood to store that field.",
      "revId": "b88cc3187a2c7e4ff0003c52df5b46a8e71c9650",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bb5f3eb1_a1fe0d1f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-09-04T13:41:16Z",
      "side": 1,
      "message": "Is there harm in just supporting it?\n\nIt would be up to end users to interpret the field as they see fit.\n\nBy supporting it, we open the door to creative uses. I\u0027m sure people could come up with useful ones.\n\nFor example, assuming we have multiple clients mounted on the same host, we might be able to distinguish where the data in the DB came from by examining the field. After a remount, assuming the id changes, we would also be able to see which inodes have been updated in the DB.\n\nUltimately, if the field was added to `struct statx`, it must serve some kind of purpose and I don\u0027t want to assume that no one will ever want to use it in creative ways with robinhood.",
      "parentUuid": "86e6491d_b46a9f9c",
      "revId": "b88cc3187a2c7e4ff0003c52df5b46a8e71c9650",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf290255_9ae22589",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-09-04T23:53:29Z",
      "side": 1,
      "message": "\u003e Is there harm in just supporting it?\n\nsize of db?\n\n\u003e For example, assuming we have multiple clients mounted on the same host, we might be able to distinguish where the data in the DB came from by examining the field. After a remount, assuming the id changes, we would also be able to see which inodes have been updated in the DB.\n\nBut there\u0027s no guarantee it won\u0027t be the same again?\nIn fact it\u0027s quite likely it\u0027ll be the same, I just tried umount/mount and got the same here.\nIn a fleet of identical machine I\u0027d also assume it\u0027ll be identical on quite a few of these, varying when system upgrades or something changes mount order (race condition on boot), or the phase of the moon maybe but nothing users can rely on. \n\n(FWIW I checked, it\u0027s the same mount id as name_to_handle_at, and also the first field of /proc/self/mountinfo)\n\n\u003e Ultimately, if the field was added to `struct statx`, it must serve some kind of purpose and I don\u0027t want to assume that no one will ever want to use it in creative ways with robinhood.\n\nOh, but it has uses.\nFor immediate consumption I can see at least two:\n - for implementing something like -xdev (not processing entries of different mountpoints), this is simpler to compare than dev/rdev -- although I expect not much will use it until it\u0027s reliably available everywhere\n - by cross-checking with /proc/self/mountinfo it\u0027s possible to immediately get the mount point an arbitrary file is in, without going through its parents until dev/rdev changes.\n\nThe original reason it was added seems similar:\nhttps://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id\u003dfa2fcf4f1df1559a0a4ee0f46915b496cc2ebf60\n\"Systemd is hacking around to get it and it\u0027s trivial to add to statx, so...\"\n\n\nAnyway, I don\u0027t mind allowing this somehow (compile or runtime option), but I don\u0027t like storing useless info in db just because we can get it.\nIf someone eventually comes up with a use for it, they can open an issue or github to discuss or just bring this patch back to life...",
      "parentUuid": "bb5f3eb1_a1fe0d1f",
      "revId": "b88cc3187a2c7e4ff0003c52df5b46a8e71c9650",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "258893e0_13fe9342",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-09-05T00:43:34Z",
      "side": 1,
      "message": "\u003e \u003e Is there harm in just supporting it?\n\n\u003e size of db?\n\nSupport in the backend doesn\u0027t mean one _has_ to upload the data.\n\nWe can write rbh-fsevents that way, or more likely, we can add a toggle to rbh-fsevent to allow/prevent the data from being collected and uploaded.\n\nWe could even imagine putting a filter after rbh-fsevents to clean the mnt_id from the generated fsevents:\n\n rbh-fsevents \u003csource\u003e - | clean-mount-id | rbh-fsevents - rbh:mongo:scratch\n\n\n\u003e \u003e After a remount, assuming the id changes, we would also be able to see which inodes have been updated in the DB.\n\n\u003e But there\u0027s no guarantee it won\u0027t be the same again?\n\nIf you umount the original mountpoint, no, for sure, but if it\u0027s still mounted, I think the id is guaranteed to be unique.\n\n\u003e In a fleet of identical machine I\u0027d also assume it\u0027ll be identical on quite a few of these\n\nI agree, but librobinhood is meant to be used for more than just distributed filesystems. I can imagine someone building a very specific application for local filesystems that makes use of the mount id in some way.\n\n\u003e Anyway, I don\u0027t mind allowing this somehow (compile or runtime option), but I don\u0027t like storing useless info in db just because we can get it.\n\nThen we are good. \u003d]",
      "parentUuid": "cf290255_9ae22589",
      "revId": "b88cc3187a2c7e4ff0003c52df5b46a8e71c9650",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5fec67a7_b7154dbc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-09-09T17:06:40Z",
      "side": 1,
      "message": "ping",
      "parentUuid": "258893e0_13fe9342",
      "revId": "b88cc3187a2c7e4ff0003c52df5b46a8e71c9650",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02b99912_c3340845",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-09-09T21:41:54Z",
      "side": 1,
      "message": "Sorry. Hm. Well, I believe in the strength of defaults, and if it\u0027s there, and the statx code from the posix backend (\u003d\u003d rbh-sync) and fsevents populate MNT_ID by default, it will get into the DB and I don\u0027t like it.\n\nThe fsevents code isn\u0027t made yet so I can\u0027t comment on that, but rbh-sync already is going in a direction I don\u0027t like, so I can\u0027t approve this.\nI\u0027ve removed the -1 and will let you convince others :-D",
      "parentUuid": "5fec67a7_b7154dbc",
      "revId": "b88cc3187a2c7e4ff0003c52df5b46a8e71c9650",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c93fda82_59fb8af1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1018755
      },
      "writtenOn": "2021-09-09T21:54:14Z",
      "side": 1,
      "message": "Fair enough. I\u0027ll try to add an option to rbh-sync that controls which fields are to be synced and which are not, making the default \"everything but mnt_id\".\n\nFrom there, it\u0027s only a matter of adding a --{,no-}mount-id option to rbh-fsevents (making --no-mount-id the default).\n\nThis patch can wait until the rest is up for review.\nThen again, if you trust me to implement it, a +1 right now is also appreciated ðŸ˜Š",
      "parentUuid": "02b99912_c3340845",
      "revId": "b88cc3187a2c7e4ff0003c52df5b46a8e71c9650",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "87ffa105_c5255ca8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2021-09-09T22:36:24Z",
      "side": 1,
      "message": "Fair enough. I won\u0027t forget and my grudges run deep if you don\u0027t do it :P",
      "parentUuid": "02b99912_c3340845",
      "revId": "b88cc3187a2c7e4ff0003c52df5b46a8e71c9650",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}