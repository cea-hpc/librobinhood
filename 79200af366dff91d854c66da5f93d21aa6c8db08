{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e86aa638_4cf2a245",
        "filename": "src/backends/lustre/lustre.c",
        "patchSetId": 8
      },
      "lineNbr": 151,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-05-17T11:25:30Z",
      "side": 1,
      "message": "For what it\u0027s worth with -O \u003e\u003d -O1 (rpmbuild builds with -O2), strlen(magic_str) will be computed at compile time if the string is assigned a constant, so in practice free.\nI\u0027d suggest using magic_str_len \u003d strlen(magic_str) here and below to avoid silly mistakes...",
      "revId": "79200af366dff91d854c66da5f93d21aa6c8db08",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5af597a7_324347d1",
        "filename": "src/backends/lustre/lustre.c",
        "patchSetId": 8
      },
      "lineNbr": 225,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-05-17T11:25:30Z",
      "side": 1,
      "message": "why is layout different from hsm state? Can a symlink or block device or socket be archived?...",
      "revId": "79200af366dff91d854c66da5f93d21aa6c8db08",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7b5491ba_4dde2818",
        "filename": "src/backends/lustre/lustre.c",
        "patchSetId": 8
      },
      "lineNbr": 225,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2022-05-17T12:24:12Z",
      "side": 1,
      "message": "I\u0027m not sure I understand the question. Do you mean: why is the function xattr_get_hsm called on every type of file, not just regular files?\n\nIf so, I think you just raised a valid point. Lustre doesn\u0027t mind giving me the HSM state of a file through a symbolic link. But it is probably best not to store the HSM state with the file and all its symbolic links.\n\n\"lfs hsm_archive\" will only accept regular files while \"lfs hsm_archive -m \u003cmountpoint\u003e \u003cfid\u003e\" will accept any FID.\nBut archiving a symlink by FID will result in the request stuck in the coordinator\u0027s llog... I\u0027m not sure if this is a feature. This needs a bit more investigation.\n\nIt seems to be the copytool which doesn\u0027t allow symlinks: the FID is opened with O_NOFOLLOW in llapi_hsm_action_begin.\n\nAnyway, I think it\u0027s safe to say that a symlink cannot be archived. Archiving a socket results in an ENODEV error from llapi_hsm_action_begin.\n\nWe should definitly filter non regular files in xattr_get_hsm.",
      "parentUuid": "5af597a7_324347d1",
      "revId": "79200af366dff91d854c66da5f93d21aa6c8db08",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8856aa81_c03f34f6",
        "filename": "src/backends/lustre/lustre.c",
        "patchSetId": 8
      },
      "lineNbr": 225,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-05-17T12:29:07Z",
      "side": 1,
      "message": "Yes, I was wondering why we needed is_dir for the other when you\u0027re having is_reg here... but then I saw you use is_dir later on for dir striping so it\u0027s not really a problem either.\n\nLet\u0027s just use is_reg for hsm state though :)",
      "parentUuid": "7b5491ba_4dde2818",
      "revId": "79200af366dff91d854c66da5f93d21aa6c8db08",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}