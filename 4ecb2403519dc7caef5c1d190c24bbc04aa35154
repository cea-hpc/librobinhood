{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d86dab11_53b9cae4",
        "filename": "include/robinhood/filter.h",
        "patchSetId": 1
      },
      "lineNbr": 163,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-10-25T12:53:29Z",
      "side": 1,
      "message": "this needs a comment like the others saying when this is valid.",
      "revId": "4ecb2403519dc7caef5c1d190c24bbc04aa35154",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "15b9524f_17fe988a",
        "filename": "src/backends/mongo/fields.c",
        "patchSetId": 1
      },
      "lineNbr": 170,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-10-25T12:53:29Z",
      "side": 1,
      "message": "this hardcodes \"$add\" below so it\u0027s not just concatenating two fields from field; this should probably just be named bson_append_rbh_add_fields or something",
      "revId": "4ecb2403519dc7caef5c1d190c24bbc04aa35154",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5faeb5e8_4263acab",
        "filename": "src/backends/mongo/fields.c",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-10-25T12:53:29Z",
      "side": 1,
      "message": "(style) why is that cast needed?",
      "range": {
        "startLine": 183,
        "startChar": 46,
        "endLine": 183,
        "endChar": 55
      },
      "revId": "4ecb2403519dc7caef5c1d190c24bbc04aa35154",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aa73ab94_8b4c4c90",
        "filename": "src/backends/mongo/fields.c",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-10-25T12:53:29Z",
      "side": 1,
      "message": "I guess that\u0027s more a bug of field2str or rather of its API, but if it actually allocs a bigger buffer here you never free the original buffer as asprintf will have changed the memory fieldA_buffer points to.\n(that kind of API is quite impossible to properly make work as asprintf failures would leave buffer in an undefined state...)\n\nAt this point it\u0027d be easier to have a char[] for buffer, a real pointer initialized to that char[] for this, and freeing conditionally on whether pointer changed.\n... also ignoring the fact that you\u0027re just not freeing in all the error cases...",
      "revId": "4ecb2403519dc7caef5c1d190c24bbc04aa35154",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4776dae7_ef2aacdd",
        "filename": "src/backends/mongo/fields.c",
        "patchSetId": 1
      },
      "lineNbr": 193,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-10-25T12:53:29Z",
      "side": 1,
      "message": "this has length.. 4? max uint32 length is 12 iirc (including \\0), not sure where key comes from but if you assume it\u0027s \u003c 1000 you should check that.",
      "range": {
        "startLine": 193,
        "startChar": 48,
        "endLine": 193,
        "endChar": 57
      },
      "revId": "4ecb2403519dc7caef5c1d190c24bbc04aa35154",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3a9a261_3421ad34",
        "filename": "src/backends/mongo/filter.c",
        "patchSetId": 1
      },
      "lineNbr": 261,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-10-25T12:53:29Z",
      "side": 1,
      "message": "(style) I think these local variables would make more sense (easier to read) if declared in the if() -- there doesn\u0027t seem to be any clear rules of declaring all variables at start of function in librobinhood, we already have some local variables in loops and things like this.",
      "revId": "4ecb2403519dc7caef5c1d190c24bbc04aa35154",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c04c5f70_1b1f8d47",
        "filename": "src/backends/mongo/filter.c",
        "patchSetId": 1
      },
      "lineNbr": 342,
      "author": {
        "id": 1003556
      },
      "writtenOn": "2022-10-25T12:53:29Z",
      "side": 1,
      "message": "(open question)\nMy first impression on this is that it took me way too long to understand what in_expr was (grmbl no actual example or test code using it), and it\u0027s quite ugly to add a new argument everywhere...\nBut I guess that\u0027s as good as it\u0027d get for using $expr.\n\nI\u0027m not too familiar with mongo though, what\u0027s the advantage of $expr over e.g. $let?\nhttps://www.mongodb.com/docs/manual/reference/operator/aggregation/let/#mongodb-expression-exp.-let\n```\n  $let: {\n    vars: {\n      total: { $add: [ \u0027$price\u0027, \u0027$tax\u0027 ] },\n      discounted: { $cond: { if: \u0027$applyDiscount\u0027, then: 0.9, else: 1 } }\n    },\n    in: { $multiply: [ \"$$total\", \"$$discounted\" ] }\n  }\n```\n\ncould be constructed as\n```\nbegin($let)\nbegin(vars)\n  begin(sums)\n    $add: val1, val2\n  end(sums)\nend(vars)\nbegin(in)\n  normal comparison without any modification, using \u0027$$sums\u0027 as value\nend(in)\nend($let)\n```\nand would avoid the extra bool argument just for comparison that was different in $expr block.",
      "revId": "4ecb2403519dc7caef5c1d190c24bbc04aa35154",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}